const messages = document.getElementById("messages");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

// Variable pour savoir si on est dans une "conversation spÃ©ciale"
let conversationState = null;

// Base de connaissances
const knowledgeBase = [
  {
    keywords: ["imprimante", "printer", "impression"],
    response: "Si vous ne voyez pas lâ€™imprimante :<br>1ï¸ RedÃ©marrez votre session.<br>2ï¸ DÃ©brancher rebrancher le cÃ¢ble jaune (rÃ©seau) <br>3 Si cela ne fonctionne pas, appelez le support IT au 2100."
  },
  {
    keywords: ["wifi", "wifi public", "SSID public", "mot de passe wifi"],
    response: "Le code du Wi-Fi public est : <b>RfdX2133%m</b>"
  },
  {
    keywords: ["Ã©cran", "dupliquÃ©", "double Ã©cran" "souris"],
    response: "Pour rÃ©soudre un Ã©cran dupliquÃ© ou une souris discontinue :<br>1ï¸âƒ£ Fermez votre session.<br>2ï¸âƒ£ Faites <b>Windows + O</b> jusquâ€™Ã  ce que la souris circule correctement."
  },
  {
    keywords: ["Raccourcis", "raccourci"],
    response: "Pour ajouter un raccourci Ã  votre bureau :<br>1ï¸âƒ£ Aller dans l'icÃ´ne banque de raccourcis situÃ©e sur votre bureau.<br>2ï¸âƒ£ Copier-coller le raccourci voulu sur votre bureau. --> Si le raccourci n'est pas disponible dans la banque de raccourcis, faire un bon SPOC"
  },
  {
    keywords: ["visio", "son", "camÃ©ra", "visioconfÃ©rence"],
    response: "Pour rÃ©soudre votre problÃ¨me, suivez la procÃ©dure suivante :<br>lien vers la procÃ©dure."
  },
  {
    keywords: ["internet", "connexion"],
    response: "Etes vous sur un PC portable ou fixe ?<br>" +
              "ğŸ‘‰ Tapez <b>1</b> PC portable<br>" +
              "ğŸ‘‰ Tapez <b>2</b> PC fixe"
  },
  {
    keywords: ["outlook"],
    response: "Quel est votre problÃ¨me avec Outlook ?<br>" +
              "ğŸ‘‰ Tapez <b>1</b> si Outlook ne dÃ©marre pas<br>" +
              "ğŸ‘‰ Tapez <b>2</b> si vous avez une erreur de connexion"
              "ğŸ‘‰ Tapez <b>3</b> si Outlook est ralenti"
  }
];

// Fonction d'affichage des messages
function addMessage(text, sender) {
  const div = document.createElement("div");
  div.classList.add("msg", sender);
  div.innerHTML = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

// Gestion des rÃ©ponses
function getBotResponse(input) {
  input = input.toLowerCase();

  // Cas spÃ©cial : si on est en mode Outlook
  if (conversationState === "outlook") {
    if (input === "1") {
      conversationState = null;
      return "Solution : Fermez et redÃ©marrez Outlook. Si Ã§a ne marche pas, redÃ©marrez votre PC.";
    }
    if (input === "2") {
      conversationState = null;
      return "Solution : VÃ©rifiez votre mot de passe. Si le problÃ¨me persiste, contactez le support IT (2100) afin qu'on vous le rÃ©initialise.";
    }
    if (input === "3") {
      conversationState = null;
      return "Solution : Effacez les cookies en suivant la procÃ©dure suivante : .";
    }
  }

  // Recherche dans la base
  for (let item of knowledgeBase) {
    for (let keyword of item.keywords) {
      if (input.includes(keyword)) {
        if (keyword === "outlook") {
          conversationState = "outlook"; // On active le mode spÃ©cial
        }
        return item.response;
      }
    }
  }
 // Cas spÃ©cial : si on est en mode internet
  if (conversationState === "internet") {
    if (input === "1") {
      conversationState = null;
      return "Solution : VÃ©rifiez votre connexion WIFI et le mot de passe.";
    }
    if (input === "2") {
      conversationState = null;
      return "Solution : dÃ©branchez rebrancher le cÃ¢ble rÃ©seau noir ou gris";
    }
  }

  // Recherche dans la base
  for (let item of knowledgeBase) {
    for (let keyword of item.keywords) {
      if (input.includes(keyword)) {
        if (keyword === "internet") {
          conversationState = "internet"; // On active le mode spÃ©cial
        }
        return item.response;
      }
    }
  }

  return "DÃ©solÃ©, je n'ai pas compris. Veuillez contacter le support IT au 2100.";
}

// Envoi du message
function sendMessage() {
  const text = userInput.value.trim();
  if (text === "") return;
  addMessage(text, "user");
  const response = getBotResponse(text);
  setTimeout(() => addMessage(response, "bot"), 500);
  userInput.value = "";
}

sendBtn.addEventListener("click", sendMessage);
userInput.addEventListener("keypress", function(e) {
  if (e.key === "Enter") sendMessage();
});
